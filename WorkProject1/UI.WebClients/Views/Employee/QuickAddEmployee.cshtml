@{
    ViewBag.Title = "Quick Add Employee";
}
@section Styles{
    <link href="~/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />
}

<div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid" ng-controller="employeeCtrl">
    <div class="row">
        <div class="kt-portlet kt-portlet--mobile">
            <div class="kt-portlet__head kt-portlet__head--lg">
                <div class="kt-portlet__head-label">
                    <h3 class="kt-portlet__head-title">
                        <!----Titel Text-->
                        Quick Add Employee
                        <!----Titel Text -->
                    </h3>
                </div>
            </div>

            <div class="kt-portlet__body">
                <form name="addBasic" ng-submit="save()" class="form-horizontal">
                    <div class="form-body form-horizontal">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.EmpID.$invalid}">
                                            <label class="col-md-3 control-label text-right">
                                                Employee ID:
                                            </label>
                                            <div class="col-md-9">
                                                <input type="text" ng-model="employeeInfo.EmpID" class="form-control" placeholder="Employee ID" required>
                                                <div class="form-control-focus"> </div>
                                                <span class="help-block" style="color:red" ng-if="submitted && addBasic.EmpID.$error.pattern">Special charecters are not allowed</span>
                                            </div>
                                        </div>
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.FullName.$invalid}">
                                            <label class="col-md-3 control-label text-right">
                                                Employee Name:
                                                <span class="required">*</span>
                                            </label>
                                            <div class="col-md-9">
                                                <input type="text" ng-model="employeeInfo.FullName" class="form-control" placeholder="Employee Name" name="FullName" required>
                                                <span ng-show="submitted &&  addBasic.FullName.$error.required" class="help-block">Employee Name Required</span>
                                                <div class="form-control-focus"> </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.stuimage.$invalid}">
                                            <div class="col-md-12">
                                                <div class="fileinput fileinput-new" data-provides="fileinput">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 80px; height: 82px; border: 1px solid #ddd"> </div>
                                                        </div>
                                                        <div class="col-md-8">
                                                            <span class="btn red btn-outline btn-file mt-3">
                                                                <span class="fileinput-new btn btn-primary"> Select image </span>
                                                                <span class="fileinput-exists btn btn-warning"> Change </span>
                                                                <input type="file" id="imgs" name="Image">
                                                            </span>
                                                            <a href="javascript:;" style="margin-top:10px !important; margin-left:-13px" class="btn btn-danger fileinput-exists" data-dismiss="fileinput"> Remove </a>
                                                            <span ng-show="submitted &&  addBasic.stuimage.$error.required" class="help-block">Photo Required</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.Department.$invalid}">
                                            <label class="col-md-4 control-label text-right">
                                                Department:
                                                <span class="required">*</span>
                                            </label>
                                            <div class="col-md-8">
                                                <select class="form-control" ng-model="employeeInfo.DepartmentID" required name="Department" ng-options="employeeInfo.DepartmentID as employeeInfo.DepartmentName for employeeInfo in CommonFeilds.Department">
                                                    <option value="" selected="selected">Choose Option</option>
                                                </select>
                                                <span ng-show="submitted &&  addBasic.Department.$error.required" class="help-block">Department Required</span>
                                                <div class="form-control-focus"> </div>
                                            </div>
                                        </div>
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.Designation.$invalid}">
                                            <label class="col-md-4 control-label text-right">
                                                Designation:
                                                <span class="required">*</span>
                                            </label>
                                            <div class="col-md-8">
                                                <select class="form-control" ng-model="employeeInfo.DesignationID" required name="Designation" ng-options="employeeInfo.DesignationID as employeeInfo.DesignationName for employeeInfo in CommonFeilds.Designation">
                                                    <option value="" selected="selected">Choose Option</option>
                                                </select>
                                                <span ng-show="submitted &&  addBasic.Designation.$error.required" class="help-block">Designation Required</span>
                                                <div class="form-control-focus"> </div>
                                            </div>
                                        </div>
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.Branch.$invalid}">
                                            <label class="col-md-4 control-label text-right">
                                                Branch:
                                                <span class="required">*</span>
                                            </label>
                                            <div class="col-md-8">
                                                <select class="form-control" ng-model="employeeInfo.BranchID" required name="Branch" ng-options="employeeInfo.BranchId as employeeInfo.BranchName for employeeInfo in CommonFeilds.Branch">
                                                    <option value="" selected="selected">Choose Option</option>
                                                </select>
                                                <span ng-show="submitted &&  addBasic.Branch.$error.required" class="help-block">Branch Required</span>
                                                <div class="form-control-focus"> </div>
                                            </div>
                                        </div>
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.SMSNotificationNo.$invalid}">
                                            <label class="col-md-4 control-label text-right">
                                                SMS Notification No:
                                                <span class="required">*</span>
                                            </label>
                                            <div class="col-md-8">
                                                <input type="text" ng-model="employeeInfo.SMSNotificationNo" class="form-control" ng-pattern="/^(?:\+?88)?01[13-9]\d{8}$/" onkeypress='return event.charCode >= 46 && event.charCode <= 57 || event.charCode == 0 ' placeholder="SMS Notification No" name="SMSNotificationNo" required>
                                                <span class="help-block" style="color:red" ng-if="employeeInfo.SMSNotificationNo.$error.pattern">Invaild Number </span>
                                                <span class="help-block" style="color:red" ng-if="submitted && addBasic.SMSNotificationNo.$invalid">Invaild Number (Ex: 019../017../018../016..) </span>
                                                <span ng-show="submitted && addBasic.SMSNotificationNo.$error.required" class="help-block">SMS Required</span>
                                                <div class="form-control-focus"> </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.Class.$invalid}">
                                            <label class="col-md-4 control-label text-right">
                                                Category:
                                                @*<span class="required">*</span>*@
                                            </label>
                                            <div class="col-md-8">
                                                <select class="form-control" ng-model="employeeInfo.CategoryID" name="Class" ng-change="" ng-options="employeeInfo.CategoryID as employeeInfo.CategoryName for employeeInfo in CommonFeilds.Category">
                                                    <option value="" selected="selected">Choose Option</option>
                                                </select>
                                                @*<span ng-show="submitted &&  addBasic.Department.$error.required" class="help-block">Department Required</span>*@
                                                <div class="form-control-focus"> </div>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-md-4 control-label text-right">
                                                Team:
                                            </label>
                                            <div class="col-md-8">
                                                <select class="form-control" ng-model="employeeInfo.TeamId" name="TeamId" ng-options="employeeInfo.Value as employeeInfo.Text for employeeInfo in Dropdowns | filter:Type='Team'">
                                                    <option value="" selected="selected">Choose Option</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.JoiningDate.$invalid}">
                                            <label class="col-md-4 control-label text-right" style="padding-left:2px">
                                                Joining Date:
                                                <span class="required">*</span>
                                            </label>
                                            <div class="col-md-8">
                                                <input class="form-control" name="JoiningDate" type="datetime" required placeholder="Joining Date" readonly @*ng-change="getOrderbydate()"*@ ng-click="p1=true" is-open="p1" uib-datepicker-popup="dd-MM-yyyy" ng-model="employeeInfo.joiningDate" />
                                                <span ng-show="submitted &&  addBasic.JoiningDate.$error.required" class="help-block text-danger">Joining Date Required</span>
                                                <div class="form-control-focus"> </div>
                                            </div>
                                        </div>
                                        <div class="form-group row" ng-class="{ 'has-error' : submitted && addBasic.DateOfBirth.$invalid}">
                                            <label class="col-md-4 control-label text-right">
                                                Date of Birth:
                                                <span class="required">*</span>
                                            </label>
                                            <div class="col-md-8">
                                                <input class="form-control" type="text" ng-change="getOrderbydate()" required ng-click="p2=true" is-open="p2" uib-datepicker-popup="dd-MM-yyyy" ng-model="employeeInfo.dateOfBirth" readonly placeholder="Date of Birth" name="DateOfBirth" />
                                                <span ng-show="submitted &&  addBasic.DateOfBirth.$error.required" class="help-block text-danger">Date of Birth Required</span>
                                                <div class="form-control-focus"> </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="form-actions top text-right">
                                    <div class="row">
                                        <div class="col-md-offset-8 col-md-10">
                                            <button type="button" data-dismiss="modal" class="btn  btn-secondary" ng-click="resetForm();submitted=false">Cancel</button>
                                            <button type="submit" ng-click="submitted=true" class="btn btn-success">Save</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    @*<script src="~/assets/global/plugins/jquery-repeater/jquery.repeater.min.js"></script>*@
    <script src="~/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
    <script src="~/assets/pages/scripts/form-repeater.min.js"></script>

    <script type="text/javascript">
        for (i = new Date().getFullYear() ; i > 1900; i--) {
            $('#yearpicker').append($('<option />').val(i).html(i));
        }
    </script>
    <script type="text/javascript">
        OEMSApp.controller("employeeCtrl", ["$scope", "$http", "SweetAlert",
            function ($scope, $http, SweetAlert) {
                init();
                function init() {
                    initialize();
                    getAllDropdowns();
                    getAllCommons();
                    //getEmpAutoID();
                }
                function initialize() {
                    $scope.CommonFeilds = [];
                    $scope.getAllDropdowns = getAllDropdowns;
                    $scope.employeeInfo = {};
                    $scope.employeeInfo.EmpID = '';
                    $scope.resetForm = resetForm;
                }

                function resetForm() {
                    $scope.employeeInfo = {};
                    $(".fileinput").fileinput("clear");
                    $scope.submitted = false;
                }

                $scope.save = function save() {
                    if ($scope.employeeInfo.EmpID == null || $scope.employeeInfo.EmpID == 'undefined') {
                        toastr["warning"]("Please Generate Student ID!!");
                        return;
                    }
                    var files = $("#imgs").get(0).files;
                    $http({
                        method: 'POST',
                        url: baseUrl + '/Employee/AddEmployee/',
                        headers: { 'Content-Type': undefined },
                        transformRequest: function (data) {
                            var formData = new FormData();
                            formData.append('studentBasicInfo', JSON.stringify($scope.employeeInfo));
                            if (files.length > 0)
                                formData.append("Img", files[0]);
                            return formData;
                        },
                        data: { studentBasicInfo: $scope.employeeInfo }
                    }).then(function successCallback(response) {
                        //$scope.employeeInfo.EmpBasicInfoID = response.data.results[0];
                        resetForm();
                        toastr["info"](response.data.message);
                    }, function errorCallback(response) {
                        toastr["warning"](response.data.Message);
                    });
                };
                function getAllDropdowns() {
                    $scope.Dropdowns = [];
                    $http({
                        method: 'GET',
                        url: baseUrl + 'Common/GetAllDropDown/'
                    }).then(function successCallback(response) {
                        console.log(response)
                        $scope.Dropdowns = response.data.results;
                    }, function errorCallback(response) {
                    });
                }

                function getAllCommons() {
                    $scope.CommonFeilds = [];
                    $http({
                        method: 'GET',
                        url: baseUrl + 'Common/GetCommonItemEmp/'
                    }).then(function successCallback(response) {
                        $scope.CommonFeilds = response.data.results;
                    }, function errorCallback(response) {
                    });
                }
                //Khaled
                function getEmpAutoID() {
                    $scope.CommonFeilds = [];
                    $http({
                        method: 'GET',
                        url: baseUrl + 'Employee/GetEmployeeAutoGenID/'
                    }).then(function successCallback(response) {
                        $scope.employeeInfo.EmpID = response.data.results;
                    }, function errorCallback(response) {
                    });
                }

            }]);
    </script>
}