

@{
    ViewBag.Title = "Attendance";
    Layout = "~/Views/Shared/_adminLayout.cshtml";
}
<div class="row mt-3">
    <div class="col-lg-8">
        <div class="card">
            <h5 class="card-header attendance-card-header active">Attendance</h5>
            <div class="card-body row">
                <div class="col-lg-12 p-0">
                    <ul class="nav nav-pills mb-3 pl-3" id="pills-tab" role="tablist">
                        @*<li class="nav-item">
                            <a class="nav-link Attendance-date active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true"><span>Daily</span></a>
                        </li>*@
                        <li class="nav-item">
                            <a class="nav-link Monthly-Atten active" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false"><span>Monthly</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link Yearly-Attendance" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false"><span>Yearly </span></a>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show  " id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                            <table class="table table-striped attandance-table">
                                <thead>
                                    <tr>
                                        <th scope="col">Event</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">Attendance</th>
                                        <th scope="col" class="text-center">Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Lesson</td>
                                        <td>
                                            02-02-2019 <br>
                                            9:05 AM
                                        </td>
                                        <td>Present</td>
                                        <td>You are showing amazing progress! Keep it up</td>
                                    </tr>
                                    <tr>
                                        <td>Master Class</td>
                                        <td>
                                            02-02-2019 <br>
                                            11:05 AM
                                        </td>
                                        <td class="Absent-attendance">Absent</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Lesson</td>
                                        <td>
                                            02-02-2019 <br>
                                            9:05 AM
                                        </td>
                                        <td>Present</td>
                                        <td>All that practicing really paid off</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Group Theory
                                            Class
                                        </td>
                                        <td>
                                            02-02-2019 <br>
                                            9:05 AM
                                        </td>
                                        <td>Present</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Recital</td>
                                        <td>
                                            02-02-2019 <br>
                                            9:05 AM
                                        </td>
                                        <td>Present</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Group Theory
                                            Class
                                        </td>
                                        <td>
                                            02-02-2019 <br>
                                            9:05 AM
                                        </td>
                                        <td class="Absent-attendance">Absent</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Master Class</td>
                                        <td>
                                            02-02-2019 <br>
                                            9:05 AM
                                        </td>
                                        <td>Present</td>
                                        <td>You are showing amazing progress! Keep it up</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="tab-pane fade show active" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                            <div class="calender">
                                <div class="row">
                                    <div class="col-lg-5">
                                        <h3>Academic Calender</h3>
                                    </div>
                                </div>
                                <ul class="month">
                                    <li>
                                        <h1><span id="mon">January</span>-<span id="year">2016</span> </h1>

                                    </li>
                                    <span class="prev">&#10094;</span>
                                    <span class="next">&#10095;</span>
                                </ul>
                                <ul class="weeks">
                                    <li>Sa</li>
                                    <li>Su</li>
                                    <li>Mo</li>
                                    <li>Tu</li>
                                    <li>We</li>
                                    <li>Th</li>
                                    <li>Fr</li>
                                </ul>
                                <ul class="days"></ul>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                            <table class="table table-bordered yearlyatt">
                                <thead class="Yearly-Attendance">
                                    <tr>
                                        <th scope="col">Months Name</th>
                                        <th scope="col">Total Class Days</th>
                                        <th scope="col">Total Presents</th>
                                        <th scope="col">Total Absent</th>
                                        <th scope="col">Total Late</th>
                                       <th scope="col">Total Early Leave</th>
                                    </tr>
                                </thead>
                                <tbody class="yearly"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="row">
            <div class="col-lg-12 pl-0">
                <div class="Attendance-over text-center">
                    @*<h3>
                        <span>75%</span> Attendance over
                        the last 90 days
                    </h3>*@
                </div>
            </div>
            <div class="col-lg-12 mt-3 pl-0">
                <div class="card" style="width:100%;">
                    <div class="card-body resent">
                        <h3>Recent Swipes</h3>
                        <table class="table table-striped rswipes">
                            <thead>
                                @*<tr>
                                    <td>Out</th>
                                    <td>03  March  2019 </th>
                                    <td>05:12 PM</th>
                                </tr>*@
                                <tr>
                                    <th>In Time</th>
                                    <th>Out Time</th>
                                 
                                </tr>
                            </thead>
                            <tbody class="Swipes">
                                @*<tr>
                                     <td>In</td>
                                    <td>25 February 2019 </td>
                                    <td>05:12 PM</td>
                                </tr>*@
                           
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-12 mt-3 pl-0">
                <div class="card" style="width:100%;">
                    <div class="card-body resent">
                        <h3>Monthly Summary</h3>
                        <table class="table table-striped mSummary">
                            <thead>
                                <tr>
                                    <td class="recent-present">Present Days</td>
                                    <td class="Absent-present">Absent</td>
                                    @*<td class="Total-present">Total leaves</td>*@
                                    <td class="Holidays-present">Holidays</td>
                                    <td class="Holidays-present">Late In</td>
                                    <td class="Holidays-present">Early Out</td>
                                </tr>
                            </thead>
                            <tbody class="summary">
                                @*<tr>
                                    <td class="recent-present"><span></span>Present Days</th>
                                    <td> </th>
                                    <td class="text-right">05:12 PM</th>
                                </tr>
                                <tr>

                                    <td class="Absent-present"><span></span>Absent</td>
                                    <td> </td>
                                    <td class="text-right">05:12 PM</td>
                                </tr>
                                <tr>
                                    <td class="Total-present"><span></span>Total leaves</td>
                                    <td> </td>
                                    <td class="text-right">05:12 PM</td>
                                </tr>
                                <tr>
                                    <td class="Holidays-present"><span></span>Holidays</th>
                                    <td></th>
                                    <td class="text-right">05:12 PM</th>
                                </tr>
                                <tr>
                                    <td class="Hourly-present"><span></span>Hourly Out Days</td>
                                    <td></td>
                                    <td class="text-right">05:12 PM</td>
                                </tr>
                                <tr>
                                    <td class="Late-present"><span></span>Late In Days</th>
                                    <td></th>
                                    <td class="text-right">05:12 PM</th>
                                </tr>*@
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts{

    @*<script src="//cdn.addiesoft.com/studentportal/js/progress.js"></script>
        <script src="//cdn.addiesoft.com/admin/assets/global/plugins/Chart.min.js" type="text/javascript"></script>*@
    <script type="text/javascript">

        $(document).ready(function ($) {
            var attn = [];
            var AttPreDay = [];
            var AttAbsentDay = [];
            var AttWorkingDay = [];
            var StuAttendanceList = [];
            var albl = [];

            $.get("@Url.Action("GetPortalDashBoardData", "Home")", function (data) {
                attn = data.CurrMonthAttendance;
                days(0);

                //smsShow(data.SMSList);
                $("#prePercent").attr("data-percent", parseInt(data.PeresentPercent));
               //$("#totalDue").html('Taka ' + formatMoney( data.TotalDue))
               // $("#dueMonth").html(data.FeesMonth);
                //noticeShow(data.NoticeList);

                AttPreDay = data.AttPreDay;
                AttAbsentDay = data.AttAbsentDay;
                AttWorkingDay = data.AttWorkingDay;
                albl = data.Attlabel; 
                Holliday = data.Holliday;
                EarlyOut = data.EarlyOut;
                LateIN = data.LateIN;
                yearlyAttandance(albl, AttPreDay, AttAbsentDay, AttWorkingDay); 
                MonthlySummary(albl, AttPreDay, AttAbsentDay, AttWorkingDay, Holliday, LateIN, EarlyOut);
                StuAttendanceList = data.StudentAttendanceList;
                StudntAttendance(StuAttendanceList);
                //console.log(data);
                //drawchart();
            });
            var yearlyatt = document.querySelector(".yearlyatt"),
              dayItems2 = yearlyatt.querySelector(".yearly");
            var rswipes = document.querySelector(".rswipes"), 
           swipes = rswipes.querySelector(".Swipes");
            var mSummary = document.querySelector(".mSummary"),
               mSummary = mSummary.querySelector(".summary");
              //public variables
            var calender = document.querySelector(".calender"),//container of calender
                topDiv = document.querySelector('.month'),
                monthDiv = document.querySelector("#mon"),//h1 of monthes
                yearDiv = document.querySelector('#year'),//h2 for years
                weekDiv = calender.querySelector(".weeks"),//week container
                dayNames = weekDiv.querySelectorAll("li"),//dayes name
                dayItems = calender.querySelector(".days"),//date of day container
                prev = calender.querySelector(".prev"),
                next = calender.querySelector(".next"), 
               

                // date variables
                years = new Date().getFullYear(),
                monthes = new Date(new Date().setFullYear(years)).getMonth(),
                lastDayOfMonth = new Date(new Date(new Date().setMonth(monthes + 1)).setDate(0)).getDate(),
                dayOfFirstDateOfMonth = new Date(new Date(new Date().setMonth(monthes)).setDate(1)).getDay(),

                // array to define name of monthes
                monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"],

                i,//counter for day before month first day in week
                x,//counter for prev , next
                counter;//counter for day of month  days;
            function StudntAttendance(StuAttendanceList) {
                swipes.innerHTML = "";
                for (var i = 0; i < StuAttendanceList.length; i++) {
                    
                    swipes.innerHTML += "<tr><td>" + StuAttendanceList[i].InTime.toLocaleString() + "</td> <td>" + StuAttendanceList[i].OutTime.toLocaleString() + "</td></tr>";
                 
                }
            }
            function getFormattedDate(d) {
                var date = new Date(d);
                //console.log(date);
                if (date == 'Invalid Date') {
                    return '';
                }
                var year = date.getFullYear();

                var month = (1 + date.getMonth()).toString();
                month = month.length > 1 ? month : '0' + month;

                var day = date.getDate().toString();
                day = day.length > 1 ? day : '0' + day;

                return month + '/' + day + '/' + year;
            }
            function yearlyAttandance(albl, AttPreDay, AttAbsentDay, AttWorkingDay) {
                    dayItems2.innerHTML = "";
                    //console.log(albl);
                    for (var i = 0; i < albl.length; i++) {
                        //console.log(albl[i].curMonth);
                        dayItems2.innerHTML += "<tr><td> " + albl[i] + " (" + new Date().getFullYear() + " )</td><td>" + AttWorkingDay[i] + "</td><td>" + AttPreDay[i] + "</td><td>" + AttAbsentDay[i] + "</td><td>" + LateIN[i] + "</td><td>" + EarlyOut[i] + "</td></tr>";
                    }
            }
            function MonthlySummary(albl, AttPreDay, AttAbsentDay, AttWorkingDay,Holliday) {

                var date = new Date();
                 console.log()
                 mSummary.innerHTML = "";
               
                 for (var i = 0; i < albl.length; i++) {
                     if (i == date.getMonth()) {
                         
                         mSummary.innerHTML += "<tr><td>" + AttPreDay[i] + "</td><td>" + AttAbsentDay[i] + "</td><td>" + Holliday[i] + "</td><td>" + LateIN[i] + "</td><td>" + EarlyOut[i] + "</td>" + "</tr>";
                     }
                   
                }
            }
            //display dayes of month in items
            function days(x) {
                'use strict';
                dayItems.innerHTML = "";
                monthes = monthes + x;



                /////////////////////////////////////////////////
                //test for last month useful while prev ,max prevent go over array
                if (monthes > 11) {
                    years = years + 1;
                    monthes = new Date(new Date(new Date().setFullYear(years)).setMonth(0)).getMonth();
                }
                if (monthes < 0) {
                    years = years - 1;
                    monthes = new Date(new Date(new Date().setFullYear(years)).setMonth(11)).getMonth();
                }

                lastDayOfMonth = new Date(new Date(new Date(new Date().setFullYear(years)).setMonth(monthes + 1)).setDate(0)).getDate();
                dayOfFirstDateOfMonth = new Date(new Date(new Date(new Date().setFullYear(years)).setMonth(monthes)).setDate(1)).getDay();

                var curMonth = monthes + 1


                /////////////////////////////////////////////////
                yearDiv.innerHTML = years;
                monthDiv.innerHTML = monthNames[monthes];
                for (i = 0; i <= dayOfFirstDateOfMonth; i = i + 1) {
                    if (dayOfFirstDateOfMonth === 6) { break; }
                    dayItems.innerHTML += "<li> - </li>";
                }
                for (counter = 1; counter <= lastDayOfMonth; counter = counter + 1) {
                    dayItems.innerHTML += "<li class='" + getattClass(counter, monthes, years) + "'><h6> " + (counter) + "</h6><p>" + getattStatus(counter, monthes, years) + "</p> </li>";


                }
                //topDiv.style.background = colors[monthes];
                //dayItems.style.backgroundColor = 'red';
                //تمييز اليوم الحالى
                if (monthes === new Date().getMonth() && years === new Date().getFullYear()) {
                    //فى حالة التاريخ الحالى =الخلفيه خضراء
                    dayItems.children[new Date().getDate() + dayOfFirstDateOfMonth].style.background = "";
                }
            }
            prev.onclick = function () {
                'use strict';
                days(-1);//decrement monthes
            };
            next.onclick = function () {
                'use strict';
                days(1);//increment monthes
            };



            function getattClass(day, month, year) {
                for (var i = 0; i < attn.length; i++) {
                    var sDate = new Date(attn[i].CalendarDate);
                    var sM = sDate.getMonth()
                    if (sDate.getMonth() == 2 && day == 5) {
                        // console.log(sDate.getMonth());
                    }

                    if (sM == month && sDate.getFullYear() == year && sDate.getDate() == day)
                        return attn[i].ClassName;

                }
            }

            function getattStatus(day, month, year) {
                var Status = '';
                for (var i = 0; i < attn.length; i++) {
                    var sDate = new Date(attn[i].CalendarDate);
                    var sM = sDate.getMonth()
                    if (sDate.getMonth() == 2 && day == 5) {
                        // console.log(sDate.getMonth());
                    }

                    if (sM == month && sDate.getFullYear() == year && sDate.getDate() == day) {
                        if (attn[i].DayStaus == 'A')
                            Status = 'Absent'
                        else if (attn[i].DayStaus == 'P')
                            Status = 'Present'
                        else if (attn[i].DayStaus == 'H')
                            Status = attn[i].HolidayName;
                        else if (attn[i].DayStaus == 'W')
                            Status = attn[i].DayType;
                    }

                }

                return Status;
            }


 //end


        });

    </script>


}